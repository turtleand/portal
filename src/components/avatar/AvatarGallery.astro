---
import {
  avatarGalleryEntries,
  avatarGalleryConfig,
} from "../../data/avatarGallery";
import galleryControllerModule from "./gallery-controller.js?url";
import type { Locale } from "../../utils/i18n";

interface Props {
  locale: Locale;
}

const { locale = "en" }: Partial<Props> = Astro.props;
const entriesJson = JSON.stringify(avatarGalleryEntries).replace(
  /</g,
  "\\u003c",
);
const configJson = JSON.stringify(avatarGalleryConfig).replace(/</g, "\\u003c");
const galleryTitle =
  locale === "es" ? "Archivo de Evolución" : "Evolution Archive";
const prevLabel = locale === "es" ? "Anterior" : "Prev";
const nextLabel = locale === "es" ? "Siguiente" : "Next";
const initialEntry = avatarGalleryEntries[0];
const initialTitle =
  locale === "es" ? initialEntry.titleEs : initialEntry.title;
const initialDescription =
  locale === "es" ? initialEntry.descriptionEs : initialEntry.description;
---

<section
  class="relative isolate overflow-hidden rounded-3xl border border-white/10 bg-deepBlue/80 p-4 shadow-[0_20px_60px_rgba(4,10,25,0.55)] backdrop-blur sm:p-6"
  data-avatar-gallery
  data-gallery-config={configJson}
>
  <script
    type="application/json"
    data-avatar-gallery-data
    set:html={entriesJson}
  />
  <div class="space-y-6">
    <header class="text-center">
      <h2
        class="text-3xl font-heading text-offWhite"
        data-gallery-heading
        data-heading-en="Evolution Archive"
        data-heading-es="Archivo de Evolución"
      >
        {galleryTitle}
      </h2>
    </header>
    <div
      class="relative flex flex-col gap-4 rounded-2xl border border-white/10 bg-gradient-to-br from-emerald-900/30 via-deepBlue to-deepBlue/80 p-4 sm:rounded-[28px] sm:p-6"
      data-gallery-stage
    >
      <div
        class="relative mx-auto flex h-[260px] max-h-[60vh] w-full max-w-2xl items-center justify-center sm:h-[320px] sm:max-h-[70vh] md:h-[360px]"
        data-gallery-stage-canvas
        data-gallery-hover-zone
      >
        <img
          data-gallery-final
          src={avatarGalleryEntries[0].finalImage}
          alt={initialTitle}
          class="h-full w-full object-contain will-change-transform"
          loading="eager"
        />
        <div class="speech-bubble" data-gallery-speech-bubble>
          <span class="speech-bubble-text" data-gallery-speech-text>
            {avatarGalleryEntries[0].italianQuote || ''}
          </span>
          <div class="speech-bubble-tail"></div>
        </div>
      </div>
      <div class="text-center space-y-1.5">
        <p class="text-base font-semibold uppercase tracking-[0.12em] text-emerald-50/90 sm:text-sm sm:tracking-[0.18em]">
          <span data-gallery-meta>
            {avatarGalleryEntries[0].version} • {avatarGalleryEntries[0].date}
          </span>
        </p>
        <h3 class="text-2xl font-heading text-offWhite" data-gallery-title>
          {initialTitle}
        </h3>
        <p class="text-offWhite/70" data-gallery-description>
          {initialDescription}
        </p>
      </div>
      <div
        class="flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-center sm:gap-4"
      >
        <button
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-full border border-emerald-200/70 bg-emerald-400/35 px-5 py-2.5 text-base font-semibold uppercase tracking-[0.1em] text-offWhite shadow-glow transition hover:bg-emerald-400/45 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent sm:w-auto sm:text-sm sm:tracking-[0.18em]"
          data-gallery-action="prev"
          aria-label={locale === "es" ? "Avatar anterior" : "Previous avatar"}
          data-prev-aria-es="Avatar anterior"
          data-prev-aria-en="Previous avatar"
        >
          <svg viewBox="0 0 32 32" class="h-4 w-4" aria-hidden="true">
            <path
              d="m18 10-6 6 6 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
          <span
            data-gallery-prev-label
            data-label-en="Prev"
            data-label-es="Anterior"
          >
            {prevLabel}
          </span>
        </button>
        <button
          type="button"
          class="inline-flex w-full items-center justify-center gap-2 rounded-full border border-emerald-200/70 bg-emerald-400/35 px-5 py-2.5 text-base font-semibold uppercase tracking-[0.1em] text-offWhite shadow-glow transition hover:bg-emerald-400/45 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-accent sm:w-auto sm:text-sm sm:tracking-[0.18em]"
          data-gallery-action="next"
          aria-label={locale === "es" ? "Siguiente avatar" : "Next avatar"}
          data-next-aria-es="Siguiente avatar"
          data-next-aria-en="Next avatar"
        >
          <span
            data-gallery-next-label
            data-label-en="Next"
            data-label-es="Siguiente"
          >
            {nextLabel}
          </span>
          <svg viewBox="0 0 32 32" class="h-4 w-4" aria-hidden="true">
            <path
              d="m14 10 6 6-6 6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>
<script type="module" src={galleryControllerModule}></script>
